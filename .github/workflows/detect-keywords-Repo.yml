name: Detect Keywords in Repo

on:
  pull_request:
  workflow_dispatch:

jobs:
  detect-keywords:
    name: ğŸ•µï¸â€â™€ï¸ Detect `console.log` and `print`
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ•µï¸â€â™€ï¸ Scan Entire Repo for Debug Keywords
        run: |
          echo "ğŸ” Scanning entire repo for debug keywords..."

          hit_flag=0
          js_hits=""
          py_hits=""

          FILE_PATHS=$(find . -type f \( -name "*.py" -o -name "*.js" \))

          while IFS= read -r file; do
            if [[ "$file" == *.js ]]; then
              results=$(grep -Hn "console.log" "$file" || true)
              if [[ -n "$results" ]]; then
                js_hits="${js_hits}\n**${file}**\n\`\`\`\n"
                while IFS= read -r line; do
                  js_hits="${js_hits}${line#"${file}:"}\n"
                done <<< "$results"
                js_hits="${js_hits}\`\`\`\n"
                hit_flag=1
              fi
            elif [[ "$file" == *.py ]]; then
              results=$(grep -Hn "print" "$file" || true)
              if [[ -n "$results" ]]; then
                py_hits="${py_hits}\n**${file}**\n\`\`\`\n"
                while IFS= read -r line; do
                  py_hits="${py_hits}${line#"${file}:"}\n"
                done <<< "$results"
                py_hits="${py_hits}\`\`\`\n"
                hit_flag=1
              fi
            fi
          done <<< "$FILE_PATHS"

          echo "## ğŸ” Keyword Scan Report" >> $GITHUB_STEP_SUMMARY
          [[ -n "$js_hits" ]] && echo -e "**console.log found in:**\n$js_hits" >> $GITHUB_STEP_SUMMARY
          [[ -n "$py_hits" ]] && echo -e "**print found in:**\n$py_hits" >> $GITHUB_STEP_SUMMARY

          if [[ "$hit_flag" == "1" ]]; then
            echo "âŒ Detected disallowed keywords."
            exit 1
          else
            echo "âœ… No disallowed keywords found."
            echo -e "\nâœ… No disallowed keywords found." >> $GITHUB_STEP_SUMMARY
          fi
