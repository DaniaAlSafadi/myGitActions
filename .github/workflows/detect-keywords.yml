name: Detect Keywords in Files

on:
  push:
    paths:
      - 'API-Build/**'
      - 'Calculator_module.py'
  pull_request:
    paths:
      - 'API-Build/**'
      - 'Calculator_module.py'
  workflow_dispatch:

jobs:
  detect-keywords:
    name: Detect console.log and print keywords
    runs-on: ubuntu-latest

    env:
      FILE_PATHS: |
        API-Build
        Calculator_module.py

    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v4

      - name: üïµÔ∏è Scan files for console.log and print
        run: |
          echo "üîç Scanning specified paths for debug keywords..."

          hit_flag=0
          js_hits=""
          py_hits=""

          while IFS= read -r path; do
            if [[ -d "$path" ]]; then
              js_files=$(find "$path" -name "*.js")
              for file in $js_files; do
                matches=$(grep -Hn "console.log" "$file" || true)
                if [[ -n "$matches" ]]; then
                  js_hits+=$'\nüìÑ '"$file"$'\n'
                  while IFS= read -r line; do
                    js_hits+="${line##$file:}"$'\n'
                  done <<< "$matches"
                  hit_flag=1
                fi
              done
            elif [[ "$path" == *.py ]]; then
              matches=$(grep -Hn "print" "$path" || true)
              if [[ -n "$matches" ]]; then
                py_hits+=$'\nüìÑ '"$path"$'\n'
                while IFS= read -r line; do
                  py_hits+="${line##$path:}"$'\n'
                done <<< "$matches"
                hit_flag=1
              fi
            fi
          done <<< "$FILE_PATHS"

          echo "## üîé Keyword Scan Report" >> $GITHUB_STEP_SUMMARY

          if [[ -n "$js_hits" ]]; then
            echo -e "console.log found in:\n$js_hits" >> $GITHUB_STEP_SUMMARY
          fi

          if [[ -n "$py_hits" ]]; then
            echo -e "print found in:\n$py_hits" >> $GITHUB_STEP_SUMMARY
          fi

          if [[ "$hit_flag" -eq 1 ]]; then
            echo "‚ùå Detected disallowed keywords."
            exit 1
          else
            echo -e "\n‚úÖ No disallowed keywords found." >> $GITHUB_STEP_SUMMARY
          fi
