name: Detect Keywords in Files

on:
  push:
    paths-ignore:
      - '.github/workflows/detect-keywords-repo.yml'
  pull_request:
    paths-ignore:
      - '.github/workflows/detect-keywords-repo.yml'
  workflow_dispatch:

jobs:
  detect-keywords:
    name: 🔎 Detect `console.log` or `print`
    runs-on: ubuntu-latest

    env:
      FILE_PATHS: |
        API-Build
        Calculator_module.py

    steps:
      - name: 📥 Checkout Repository
        uses: actions/checkout@v4

      - name: 🕵️‍♀️ Scan files for keywords (console.log, print)
        run: |
          echo "🔍 Scanning specified paths for debug keywords..."

          hit_flag=0
          js_flag=0
          py_flag=0

          while IFS= read -r path; do
            if [[ -d "$path" ]]; then
              while IFS= read -r file; do
                results=$(grep -Hn "console\.log" "$file" || true)
                if [[ -n "$results" ]]; then
                  js_hits="${js_hits}\n🗂️ ${file}\n"
                  js_hits="${js_hits}$(echo "$results" | sed -E "s|${file}:||")\n"
                  hit_flag=1
                fi
              done < <(find "$path" -type f -name "*.js" | sort)
            elif [[ "$path" == *.py ]]; then
              results=$(grep -Hn "print" "$path" || true)
              if [[ -n "$results" ]]; then
                py_hits="${py_hits}\n📄 ${path}\n"
                py_hits="${py_hits}$(echo "$results" | sed -E "s|${path}:||")\n"
                hit_flag=1
              fi
            fi
          done <<< "$FILE_PATHS"

          echo "🔎 Keyword Scan Report" >> $GITHUB_STEP_SUMMARY

          if [[ -n "$js_hits" ]]; then
            echo -e "\nconsole.log found in:${js_hits}" >> $GITHUB_STEP_SUMMARY
          fi

          if [[ -n "$py_hits" ]]; then
            echo -e "\nprint found in:${py_hits}" >> $GITHUB_STEP_SUMMARY
          fi

          if [[ "$hit_flag" -eq 1 ]]; then
            echo "❌ Detected disallowed keywords."
            exit 1
          else
            echo "✅ No disallowed keywords found."
            echo -e "\n✅ No disallowed keywords found." >> $GITHUB_STEP_SUMMARY
          fi
