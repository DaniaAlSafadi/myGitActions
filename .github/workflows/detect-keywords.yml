name: Detect Keywords in Files

on:
  push:
    paths-ignore:
      - '.github/workflows/detect-keywords-repo.yml'
  pull_request:
    paths-ignore:
      - '.github/workflows/detect-keywords-repo.yml'
  workflow_dispatch:

jobs:
  detect-keywords:
    name: 🔎 Detect `console.log` & `print`
    runs-on: ubuntu-latest

    env:
      FILE_PATHS: |
        API-Build
        Calculator_module.py

    steps:
      - name: 📥 Checkout Repository
        uses: actions/checkout@v4

      - name: 🧪 Scan files for keywords (console.log, print)
        run: |
          echo "🔍 Scanning specified paths for debug keywords..."

          hit_flag=0
          js_flag=0
          py_flag=0

          echo "## 🕵️ Keyword Scan Report" >> $GITHUB_STEP_SUMMARY

          while IFS= read -r path; do
            if [[ -d "$path" ]]; then
              while IFS= read -r file; do
                results=$(grep -Hn "console\.log" "$file" || true)
                if [[ -n "$results" ]]; then
                  if [[ "$js_flag" -eq 0 ]]; then
                    echo -e "\n### ⚠️ `console.log` found in:\n" >> $GITHUB_STEP_SUMMARY
                    js_flag=1
                  fi
                  echo -e "🗂️ _${file}_\n\`\`\`" >> $GITHUB_STEP_SUMMARY
                  echo "$results" | sed -E "s|$file:||" >> $GITHUB_STEP_SUMMARY
                  echo -e "\`\`\`" >> $GITHUB_STEP_SUMMARY
                  hit_flag=1
                fi
              done < <(find "$path" -type f -name "*.js" | sort)
            elif [[ "$path" == *.py ]]; then
              results=$(grep -Hn "print" "$path" || true)
              if [[ -n "$results" ]]; then
                if [[ "$py_flag" -eq 0 ]]; then
                  echo -e "\n### ⚠️ `print` found in:\n" >> $GITHUB_STEP_SUMMARY
                  py_flag=1
                fi
                echo -e "📄 _${path}_\n\`\`\`" >> $GITHUB_STEP_SUMMARY
                echo "$results" | sed -E "s|$path:||" >> $GITHUB_STEP_SUMMARY
                echo -e "\`\`\`" >> $GITHUB_STEP_SUMMARY
                hit_flag=1
              fi
            fi
          done <<< "$FILE_PATHS"

          if [[ "$hit_flag" -eq 1 ]]; then
            echo "❌ Detected disallowed keywords."
            exit 1
          else
            echo "✅ No disallowed keywords found."
            echo -e "\n✅ No disallowed keywords found." >> $GITHUB_STEP_SUMMARY
          fi
